---
title: "Utilitzant l'API de Notion amb Next.js"
publishedAt: '2024-02-10'
summary: "Un tutorial sobre com crear una aplicaci√≥ Next.js fent servir l‚ÄôAPI privada de Notion com a backend."
---

Aquest tutorial mostra com crear una aplicaci√≥ Next.js que:

- Obt√© el contingut d'una base de dades de Notion
- Mant√© el contingut actualitzat sense haver de tornar a desplegar l‚Äôaplicaci√≥ a Vercel
- Inclou optimitzaci√≥ d‚Äôimatges amb¬†`next/image`
- Estilitza els components f√†cilment amb Tailwind CSS

Jo l‚Äôhe fet servir per crear [aquesta p√†gina](https://www.smartido.dev/books), que cont√© una galeria d'imatges dels llibres que vaig llegir durant l‚Äôany passat. üìö

<Image
  alt="Books"
  src="/images/books/books.png"
  width={795}
  height={620}
/>

### Configurant l'aplicaci√≥

La forma m√©s f√†cil de configurar la vostra aplicaci√≥ √©s utilitzant [`create-next-app`](https://nextjs.org/docs/app/api-reference/create-next-app) per clonar-vos una aplicaci√≥ Next.js preconfigurada amb Tailwind CSS des dels [exemples oficials de Next.js](https://github.com/vercel/next.js/tree/canary/examples/with-tailwindcss).

```MDX
npx create-next-app --example with-tailwindcss book-gallery
```

Aquest exemple inclou:

- L‚Äô√∫ltima versi√≥ de Next.js
- El Prettier configurat per formatar el codi i organitzar els noms de classe de Tailwind CSS
- TypeScript configurat per Next.js
- Tailwind CSS configurat per eliminar els noms de classe no utilitzats
- Un exemple d‚Äô[API Route](https://nextjs.org/docs/pages/building-your-application/routing/api-routes)

### Creant estils per la galeria de llibres

Un cop tingueu Tailwind CSS configurat, podeu crear el component per mostrar la vostra galeria de llibres. Dins del fitxer `pages/index.tsx`, que √©s el punt d‚Äôinici de la vostra aplicaci√≥, podeu utilitzar CSS Grid per configurar el contenidor per a totes les vostres imatges.

```jsx
export default async function Books() {
  return (
    <div className="w-screen max-w-screen-2xl mx-auto absolute top-0 left-0 right-0 bg-white">
      <div className="grid grid-cols-[repeat(auto-fit,minmax(240px,1fr))] gap-8 px-8 my-16">
        {/* Books will go here */}
      </div>
    </div>
  );
}
```

A continuaci√≥, necessitareu crear un component pel llibre individual. De cada llibre, no nom√©s volem mostrar la imatge, sin√≥ que tamb√© ens agradaria mostrar algunes dades addicionals com el t√≠tol, l‚Äôautor i una puntuaci√≥. Cada imatge tamb√© enlla√ßar√† amb la botiga.

Creem un component nou amb dades <i>mockejades</i>:

```jsx
function Book() {
  return (
    <a href="#" className="flex flex-col rounded-2xl p-4 border bg-zinc-50 border-gray-200/50 hover:border-black">
      <span className="w-40 h-56 mb-2 relative">
        <img
          alt=""
          fill
          src="https://bit.ly/default-image"
          style={{ objectFit: "cover", borderRadius: "8px" }}
        />
      </span>
      <div className="flex flex-col w-full text-sm">
        <p className="mt-4 text-sm text-slate-500">@smartido_</p>
        <h3 className="mt-1 text-lg font-medium">Sara Mart√≠nez</h3>
        <p className="mt-4 w-fit rounded-md py-1 px-2 bg-gray-200/50">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</p>
      </div>
    </a>
  )
}
```

### Optimitzant les imatges

Per afavorir els [Core Web Vitals](https://developers.google.com/search/docs/appearance/core-web-vitals), us interessar√† optimitzar les imatges. Per fer-ho, podeu aprofitar els avantatges que proporciona el [component Image](https://nextjs.org/docs/pages/building-your-application/optimizing/images) de Next.js:

- **Optimitzaci√≥ de la mida**: Serveix autom√†ticament imatges de la mida correcta per a cada dispositiu, utilitzant formats d'imatge moderns com WebP i AVIF.
- **Estabilitat visual**: Evita autom√†ticament el [Cumulative Layout Shift](https://nextjs.org/learn-pages-router/seo/web-performance/cls).
- **C√†rregues de p√†gina m√©s r√†pides**: Les imatges nom√©s es carreguen quan entren al *viewport*.

Actualitzem el nostre component¬†`Book`¬†per utilitzar¬†`next/image`:

```jsx
import Image from 'next/image';

function Book() {
  return (
    <a href="#" target="_blank" className="flex flex-col rounded-2xl p-4 border bgzinc-50 border-gray-200/50 hover:border-black">
      <span className="w-40 h-56 mb-2 relative">
        <Image
          alt=""
          fill
          src="https://bit.ly/default-image"
          style={{ objectFit: "cover", borderRadius: "8px" }}
        />
      </span>
      <div className="flex flex-col w-full text-sm">
        <p className="mt-4 text-sm text-slate-500">@smartido_</p>
        <h3 className="mt-1 text-lg font-medium">Sara Mart√≠nez</h3>
        <p className="mt-4 w-fit rounded-md py-1 px-2 bg-gray-200/50">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</p>
      </div>
    </a>
  )
}
```

Utilitzem la propietat CSS `fill` per fer que la nostra imatge s‚Äôajusti al seu element pare.

El component Image de Next.js requereix que especifiquem de quins dominis podem optimitzar les imatges. En aquest cas estem utilitzant `bit.ly` com a imatge per defecte, per√≤ podem afegir qualsevol domini a la llista de permisos dins del fitxer `next.config.js`:

```jsx
/** @type {import('next').NextConfig} */
module.exports = {
  reactStrictMode: true,
  images: {
    domains: ['bit.ly'],
  },
};
```

Ara, substituim les nostres dades *mockejades* per dades reals de Notion.

### Configurant Notion

Abans d‚Äôutilitzar [Notion](https://www.notion.so/) com a backend per a la vostra aplicaci√≥, necessitareu crear una integraci√≥ al [dashboard d‚Äôintegracions de Notion](https://www.notion.so/my-integrations).

- Feu clic al bot√≥ `+ New integration`
- Escriviu el nom de la integraci√≥
- Feu clic al bot√≥ `Submit`

Un cop s‚Äôhagi creat la vostra integraci√≥, guardeu l‚ÄôAPI secret (necess√†ria per poder fer peticions d‚ÄôAPI Notion) com a¬†[variable d'entorn](https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables)¬†dins d'un nou fitxer `.env`¬†dins de la vostra aplicaci√≥ Next.js:

```MDX
NOTION_SECRET=your-secret-here
```

A continuaci√≥, instal¬∑leu el client de Notion:

```MDX
npm i @notionhq/client
```

Finalment, podem crear un nou client dins de `lib/notion.ts` i connectar-nos a Notion mitjan√ßant la nostra variable d'entorn:

```jsx
import { Client } from "@notionhq/client";

export const notion = new Client({
  auth: process.env.NOTION_SECRET,
});
```

### Afegint dades a Notion

Notion fa que resulti molt senzill organitzar dades en p√†gines i blocs, i ofereix l‚Äôopci√≥ de crear una [base de dades](https://www.notion.so/help/guides/creating-a-database) amb pocs clics. Dins del vostre *workspace* de Notion, creu una taula per les vostres imatges:

- Feu clic al bot√≥ `+ New page` i seleccioneu `Table` com a tipus de base de dades
- Seleccioneu `+ New database` dins de `Select a data souce`
- Anomeneu la primera columna `title`, que √©s on entrareu els vostres √≠tems
- Afegiu les columnes `author` (de tipus **Text**), `rating` (de tipus **Select** amb opcions de 1 a 5 estrelles), `link` i `cover` (de tipus **URL**).

Un cop afegiu contingut a la vostra base de dades, podria quedar [aix√≠](https://smartido.notion.site/smartido/154b0056ae034fb7a2a5e9efc510a3db?v=0a5696bd6001424c8c16dc9131f6834e).

<Image
  alt="Books"
  src="/images/books/database.png"
  width={795}
  height={620}
/>

Per tal que la vostra integraci√≥ pugui fer peticions a la base de dades, li heu de donar perm√≠s per llegir/escriure a aquesta base de dades espec√≠fica.

- Des de la vostra base de dades de Notion, feu clic al men√∫¬†`...`¬†a l‚Äôextrem superior dret de la p√†gina
- Seleccioneu l‚Äôopci√≥ `+ Add Connections`
- Busqueu la vostra integraci√≥ i seleccioneu-la

Finalment, afegiu una nova variable d‚Äôentorn amb l‚ÄôID de la base de dades.

```MDX
NOTION_SECRET=your-secret-here
NOTION_DATABASE_ID=your-database-id-here
```

<Callout emoji="üëç">
  Per trobar l‚ÄôID de base de dades de Notion, navegueu a la seva URL. L'ID √©s la cadena de 32 car√†cters de l'URL que es troba entre la barra inclinada que segueix el nom del *workspace* i el signe d'interrogaci√≥. 
  <Image
    alt="Books"
    src="/images/books/secret.png"
    width={795}
    height={100}
  />
</Callout>

### Obtenint dades de Notion

Pr√®viament ja hem configurat el nostre client de Notion al fitxer `lib/notion.ts`, de manera que ara ja podem obtenir tots els llibres de la nostra base de dades:

```jsx
import { Client } from "@notionhq/client";
import React from "react";
import { DatabaseObjectResponse } from "@notionhq/client/build/src/api-endpoints";

export const notion = new Client({
  auth: process.env.NOTION_TOKEN,
});

export const fetchPages = React.cache(() => {
  return notion.databases.query({
    database_id: process.env.NOTION_DATABASE_ID!,
  }).then((res) => (
    res.results as DatabaseObjectResponse[] | undefined
  )).catch((error) => {
    console.log(`Notion API error: ${error.status}`)
  });
});
```

Importarem aquestes dades dins del nostre component de React i farem un map a trav√©s de la llista de llibres.

```jsx
export default async function Books() {
  const books = await fetchPages();

  return (
    <div className="w-screen max-w-screen-2xl mx-auto absolute top-0 left-0 right-0 bg-white">
      <div className="grid grid-cols-[repeat(auto-fit,minmax(240px,1fr))] gap-8 px-8 my-16">
        {books?.map((book, i) => (
          <Book key={book.id} {...book} />
        ))}
      </div>
    </div>
  );
}
```

Despr√©s de rec√≥rrer tot el llistat, podem actualitzar el component `Book` per substituir les dades *mockejades*.

```jsx
function Book({ properties }) {
  const { title, author, link, cover, rating } = properties;

  return (
    <a href="#" target="_blank" className="flex flex-col rounded-2xl p-4 border bgzinc-50 border-gray-200/50 hover:border-black">
      <span className="w-40 h-56 mb-2 relative">
        <Image
          alt=""
          fill
          src={cover.url}
          style={{ objectFit: "cover", borderRadius: "8px" }}
        />
      </span>
      <div className="flex flex-col w-full text-sm">
        <p className="mt-4 text-sm text-slate-500">{author.rich_text[0].text.content}</p>
        <h3 className="mt-1 text-lg font-medium">{title.title[0].text.content}</h3>
        <p className="mt-4 w-fit rounded-[8px] py-1 px-2 bg-gray-200/50>{rating.select.name}</p>
      </div>
    </a>
  )
}
```

Finalment, necessitarem actualitzar la nostra llista de permisos per l'optimitzaci√≥ d'imatges per incloure l'URL de la imatge d'Amazon:

```jsx
/** @type {import('next').NextConfig} */
module.exports = {
  reactStrictMode: true,
  images: {
    domains: ['m.media-amazon.com'],
  },
};
```

### Desplegant a Vercel

La nostra galeria d‚Äôimatges est√† mostrant una llista de llibres, obtinguts de Notion, i els mostra de manera bonica amb Talwind CSS. Despleguem la nostra aplicaci√≥ a Vercel:

- Feu *push* del vostre codi al vostre repositori de Git
- Importeu el vostre projecte Next.js a Vercel
- Afegiu les vostres variables d‚Äôentorn durant la importaci√≥
- Cliqueu ‚ÄúDeploy‚Äù

Vercel detectar√† autom√†ticament que esteu utilitzant Next.js i activar√† la configuraci√≥ correcta per al vostre desplegament. Finalment, la vostra aplicaci√≥ es desplegar√† en un URL acabada amb .vercel.app o en el domini que tingueu [smartido.dev/books](https://www.smartido.dev/books).

Per exemple, si afegiu un nou llibre a la taula, es mostrar√† a la vostra aplicaci√≥ desplegada sense tornar a fer *build* de l‚Äôaplicaci√≥.

### Conclusi√≥

En aquest tutorial, hem creat una aplicaci√≥ Next.js fent servir l‚ÄôAPI privada de Notion com a *backend* per mostrar una llista d‚Äôimatges carregades din√†micament des de Notion i que s‚Äôactualitza cada cop que les dades es modifiquen.
